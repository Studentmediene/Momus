<!--
  ~ Copyright 2016 Studentmediene i Trondheim AS
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div ng-if="vm.noPublication">
    <div class="d-title">
        <h1>Ingen utgaver funnet.</h1>
    </div>
</div>

<div id="disposition" ng-hide="vm.noPublication">
    <div ng-show="vm.loading" class="d-loading-spinner">
        <i class="fa fa-circle-o-notch fa-spin fa-4x"></i>
    </div>
    <div id="title" class="d-title">
        <h1>Disposisjon for {{vm.publication.name}}</h1>
    </div>
    <div id="toolbar" uk-sticky="offset: 50; cls-active: d-toolbar-attach" class="d-toolbar">
        <div id="online-users" style="min-height: 40px">
            <div ng-repeat="user in vm.presentUsers track by user.id" style="margin: 5px">
                <person-avatar
                    user="user"
                    size="30"
                    uk-tooltip="title: {{user.name}} redigerer denne disposisjonen; pos: top">
                </person-avatar>
            </div>
        </div>
        <div class="button-group">
            <a class="uk-button uk-button-primary uk-button-small" href="/api/publications/{{vm.publication.id}}/colophon">
                <i class="fas fa-file-alt"></i> Generer kolofon
            </a>
            <button class="uk-button uk-button-primary uk-button-small" ng-click="vm.hideAllButtonRows()">
                <i class="fas fa-caret-up"></i> Lukk ekstraknapp-rader
            </button>
            <page-adder
                max-num-pages="vm.maxNewPages"
                max-page-pos="vm.publication.pages.length"
                submit="vm.newPages(newPageAt, numNewPages)">
            </page-adder>
            <button class="uk-button button-new uk-button-small" ng-click="vm.showHelp()">
                Hjelp?
            </button>
        </div>
        <!-- Headers -->
        <div class="d-table headers">
            <div class="d-table-row">
                <div class="d-table-cell" ng-style="vm.columnWidths.page_nr">#</div>
                <div class="d-table-cell">
                    <div class="d-table">
                        <div class="d-table-row">
                            <div class="d-table-cell" ng-style="vm.columnWidths.dropdown"></div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.name">Navn</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.section">Seksjon</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.journalists">Journalister</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.photographers">Fotografer</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.status">Status</div>
                            <div class="d-table cell" ng-style="vm.columnWidths.review">Korrektur</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.photo_status">Fotostatus</div>
                            <div class="d-table-cell" ng-style="vm.columnWidths.comment">Kommentar</div>
                        </div>
                    </div>
                </div>
                <div class="d-table-cell" ng-style="vm.columnWidths.layout">Layout</div>
                <div class="d-table-cell" ng-style="vm.columnWidths.done"></div>
                <div class="d-table-cell" ng-style="vm.columnWidths.edit"></div>
                <div class="d-table-cell" ng-style="vm.columnWidths.delete"></div>
            </div>
        </div>
    </div>

    <div class="row d-table disposition-table">
        <div ng-model="vm.pageOrder.order" ui-sortable="vm.sortableOptions">
            <div
                class="d-table-row"
                ng-repeat="pageId in vm.pageOrder.order"
                alias="vm.pagesLookup[pageId] as page"
                ng-class="{'page-done': page.done}"
                ui-sortable-selectable
            >
                <!--Page number-->
                <div class="d-table-cell handle" ng-style="vm.columnWidths.page_nr">{{$index + 1}}</div>
                <!--Edit mode -->
                <div class="d-table-cell" ng-style="{width: vm.articleWidth}" ng-show="editPage">
                    <div><b>Artikler</b></div>
                    <div class="d-article-input">
                        <multiselect-dropdown
                            ng-model="newArticles"
                            items="vm.publication.articles"
                            label="'name'"
                            placeholder="Artikler"
                        >
                        </multiselect-dropdown>
                        <div>
                            <button ng-click="vm.createArticle(page)" class="uk-button button-new" uk-tooltip="Lag ny artikkel">
                                <i class="fas fa-plus"></i> <i class="fas fa-file"></i>
                            </button>
                        </div>
                        
                    </div>
                    <div><b>Reklamer</b></div>
                    <div class="d-article-input">
                        <multiselect-dropdown
                            ng-model="newAdverts"
                            items="vm.adverts"
                            label="'name'"
                            placeholder="Reklamer"
                        >
                        </multiselect-dropdown>
                        <div>
                            <button ng-click="vm.createAdvert(page)" class="uk-button button-edit" uk-tooltip="Lag ny reklame">
                                <i class="fas fa-plus"></i> <i class="fas fa-bullhorn"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- View mode (articles) -->
                <div class="d-table-cell article-cell" ng-style="{width: vm.articleWidth + 'px'}" ng-hide="editPage">
                    <div
                        ng-repeat="articleId in page.articles"
                        alias="vm.articlesLookup[articleId] as article"
                    >
                        <div class="d-table">
                            <div class="d-table-row" ng-class="{'page-done': page.done}">
                                <!--Dropdown-arrow-->
                                <div class="d-table-cell" ng-style="vm.columnWidths.dropdown">
                                    <button
                                        class="uk-button uk-button-primary button-xs"
                                        ng-click="showButtons = !showButtons"
                                    >
                                        <i class="fas fa-arrows-alt-v"></i>
                                    </button>
                                </div>
                                <!--Name-->
                                <div class="d-table-cell" ng-style="vm.columnWidths.name">
                                    <a ui-sref="article.details({id: article.id})">{{article.name}}</a>
                                    <span uib-tooltip="Antall tegn">({{article.content_length}})</span>
                                </div>
                                <!--Section-->
                                <div
                                    class="d-table-cell"
                                    ng-style="vm.applyColumnWidth('section', {'background': article.section.color})"
                                >
                                        {{article.section.name}}
                                </div>
                                <!--Journalists-->
                                <div class="d-table-cell" ng-style="vm.columnWidths.journalists">
                                    <ul class="uk-list person-list">
                                        <li ng-repeat="person in article.journalists">
                                            <person-widget person="person" class="d-break-word">
                                            </person-widget>
                                        </li>
                                        <li ng-repeat="person in article.external_author.split(',')">
                                            <i>{{person}}</i>
                                        </li>
                                    </ul>
                                </div>
                                <!--Photographers-->
                                <div class="d-table-cell" ng-style="vm.columnWidths.photographers">
                                    <ul class="uk-list person-list">
                                        <li ng-repeat="person in article.photographers">
                                            <person-widget person="person">
                                            </person-widget>
                                        </li>
                                        <li ng-repeat="person in article.external_photographer.split(',')">
                                            <i>{{person}}</i>
                                        </li>
                                    </ul>
                                </div>
                                <!--Status-->
                                <div
                                    class="d-table-cell"
                                    ng-style="vm.applyColumnWidth('status', {'background': article.status.color})"
                                >
                                    <select-dropdown
                                        ng-model="article.status"
                                        items="vm.articleStatuses"
                                        label="'name'"
                                        on-change="vm.updateArticle(article)"
                                        placeholder="Status"
                                        unclearable
                                    >
                                </div>
                                <!--Review-->
                                <div
                                    class="d-table-cell"
                                    ng-style="vm.applyColumnWidth('review', {'background':article.review.color})"
                                >
                                    <select-dropdown
                                        ng-model="article.review"
                                        items="vm.reviewStatuses"
                                        label="'name'"
                                        on-change="vm.updateArticle(article)"
                                        placeholder="Korr."
                                        unclearable
                                    >
                                    </select-dropdown>
                                </div>
                                <!--Photostatus-->
                                <!--View-->
                                <div
                                    class="d-table-cell"
                                    ng-style="vm.columnWidths.photo_status"
                                    title="Klikk for å redigere"
                                >
                                    <inline-edit
                                            placeholder="[Fotostatus]"
                                            model="article.photo_status"
                                            on-save="vm.submitArticleField(article, 'photo_status', value)">
                                    </inline-edit>
                                </div>
                                <!--Comment-->
                                <div class="d-table-cell" ng-style="vm.columnWidths.comment">
                                    <inline-edit
                                            placeholder="[Kommentar]"
                                            model="article.comment"
                                            on-save="vm.submitArticleField(article, 'comment', value)">
                                    </inline-edit>
                                </div>
                            </div>
                        </div>
                        <div ng-show="showButtons" class="extra-button-line">
                            <a href="/api/article/{{article.id}}/indesignfile" class="uk-button uk-button-primary button-xs">
                                <i class="fas fa-file"></i>
                                InDesign fil
                            </a>
                            <a
                                href="https://docs.google.com/document/d/{{article.google_drive_id}}/edit"
                                target="_blank"
                                class="uk-button button-edit button-xs"
                            >
                                <i class="fas fa-edit"></i>
                                Rediger i Google Docs
                            </a>
                        </div>
                    </div>
                    <!--View mode (adverts)-->
                    <div
                            class="d-table"
                            ng-repeat="advertId in page.adverts"
                            ng-style="{'background-color':'#FFE96B'}"
                            alias="vm.advertsLookup[advertId] as advert"
                    >
                      <div class="d-table-row">
                        <!--Dropdown-arrow-->
                        <div class="d-table-cell" ng-style="vm.columnWidths.dropdown">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <!--Name-->
                        <div class="d-table-cell" ng-style="vm.columnWidths.name">
                            {{advert.name}}
                        </div>
                        <!--Quick Lazy Fix-->
                        <div class="d-table-cell" ng-style="vm.columnWidths.section"></div>
                        <div class="d-table-cell" ng-style="vm.columnWidths.journalists"></div>
                        <div class="d-table-cell" ng-style="vm.columnWidths.photographers"></div>
                        <div class="d-table-cell" ng-style="vm.columnWidths.status"></div>
                        <div class="d-table-cell" ng-style="vm.columnWidths.review"></div>
                        <div class="d-table-cell" ng-style="vm.columnWidths.photo_status"></div>
                        <!--Comment-->
                          <div class="d-table-cell" ng-style="vm.columnWidths.comment">
                              <inline-edit
                                      placeholder="[Kommentar]"
                                      model="advert.comment"
                                      on-save="vm.submitAdvertComment(advert, value)">
                              </inline-edit>
                          </div>
                      </div>
                    </div>
                </div>
                <!--Layout status-->
                <div
                    class="d-table-cell"
                    ng-style="vm.applyColumnWidth('layout', {'background': page.layout_status.color})"
                >
                    <select-dropdown
                        ng-model="page.layout_status"
                        on-change="vm.updatePageMeta(page)"
                        items="vm.layoutStatuses"
                        label="'name'"
                        unclearable
                    >
                </div>
                <!--Done-->
                <div class="d-table-cell button" ng-style="vm.columnWidths.done">
                    <span style="cursor: pointer" ng-click="page.done = !page.done; vm.updatePageMeta(page);">
                        <i class="fas fa-check fa-lg"
                            ng-class="{'uk-text-danger' : !page.done, 'uk-text-success' : page.done }"
                            uib-tooltip="Siden er {{!page.done ? 'ikke ' : ''}} helt ferdig">
                        </i>
                    </span>
                </div>
                <!--Edit-->
                <div class="d-table-cell button" ng-style="vm.columnWidths.edit">
                    <button ng-click="vm.editPage(this)" class="uk-button button-edit button-xs" ng-hide="editPage">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button ng-click="vm.submitPage(this)" class="uk-button button-new button-xs" ng-show="editPage">
                        <i class="fas fa-save"></i>
                    </button>
                </div>
                <!--Delete-->
                <div class="d-table-cell button" ng-style="vm.columnWidths.delete">
                    <button ng-click="vm.deletePage(page)" class="uk-button uk-button-danger button-xs">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
