<!--
  ~ Copyright 2014 Studentmediene i Trondheim AS
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<a href="#/artikler/ny" class="btn btn-primary btn-xs" style="margin-bottom: 5px;">
    <i class="fa fa-plus-circle"></i> Opprett ny artikkel
</a>

<div class="well well-sm" id="articleSearchInterface">
    <form role="form" ng-submit="searchFunc()">
        <div class="row">
            <!-- Free search -->
            <div class="col-sm-4">
                <label class="sr-only" for="searchFree">
                    Fritekst
                </label>
                <input class="form-control" id="searchFree" ng-model="search.free"
                       placeholder="Fritekst">
            </div>

            <!-- Status search -->
            <div class="col-sm-4">
                <label class="sr-only" for="searchStatus">
                    Status
                </label>
                <select class="form-control" id="searchStatus" ui-select2 ng-model="search.status" placeholder="Status">
                    <option class="" value="">
                        Alle statuser
                    </option>
                    <option ng-repeat="status in statuses | filter:{deleted: false} | orderBy:'status_order'" value="{{ status.id }}" style="background: #0f0">
                        {{ status.name }}
                    </option>
                </select>
            </div>

            <!-- Section search -->
            <div class="col-sm-4">
                <label class="sr-only" for="searchSection">
                    Redaksjon
                </label>
                <select class="form-control" id="searchSection" ui-select2 ng-model="search.section">
                    <option value="">
                        Alle redaksjoner
                    </option>
                    <option ng-repeat="section in sections | filter:{deleted: false}" value="{{ section.id }}">
                        {{ section.name }}
                    </option>
                </select>
            </div>

            <!-- Publication search -->
            <div class="col-sm-4">
                <label class="sr-only" for="searchPublication">
                    Utgave
                </label>
                <select class="form-control" id="searchPublication" ui-select2 ng-model="search.publication">
                    <option value="">
                        Alle utgaver
                    </option>
                    <option ng-repeat="publication in publications | orderBy: '-release_date'" value="{{ publication.id }}">
                        {{ publication.name }}
                    </option>
                </select>
            </div>

            <!-- Person search -->
            <div class="col-sm-4">
                <label class="sr-only" for="searchPersons">
                    Personer
                </label>
                <select multiple class="form-control" id="searchPersons" ui-select2 ng-model="search.persons"
                        placeholder="Velg personer">
                    <option ng-repeat="person in persons" value="{{ person.id }}">
                        {{ person.full_name }}
                    </option>
                </select>
            </div>

            <div class="col-sm-4">
                <button type="submit" id="searchSubmit" class="btn btn-primary btn-sm form-control">
                    Søk
                </button>
            </div>
        </div>
    </form>
</div>

<div class="panel panel-default">

    <!-- Results of the search -->
    <div class="panel-heading">
        <h3 class="panel-title text-center">
            Artikler
        </h3>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-striped table-condensed" style="font-size: 85%;">
            <thead>
            <tr>
                <th>Navn</th>
                <th>Type</th>
                <th>Journalister</th>
                <th>Foto/Illustrasjon</th>
                <th>Kommentar</th>
                <th>Tegn</th>
                <th>Status</th>
                <th>Redaksjon</th>
                <th>Utgave</th>
            </tr>
            </thead>

            <tbody>
            <tr ng-if="loading">
                <td colspan="10" style="text-align: center;">
                    <i class="fa fa-4x fa-spinner fa-spin"></i>
                </td>
            </tr>
            <tr ng-if="noArticles">
                <td colspan="10" style="text-align: center;">
                    Ingen artikler stemmer med søket
                </td>
            </tr>
            <tr ng-repeat="article in data">
                <td>
                    <a href="#/artikler/{{ article.id }}">
                        {{ article.name }}
                    </a>
                </td>
                <td>
                    {{ article.type.name }}
                </td>

                <td>
                    <ul class="list-unstyled">
                        <li ng-repeat="person in article.journalists">
                            <span person-widget="person">{{ person.full_name }}</span>
                        </li>
                        <li><i tooltip="Ekstern">{{article.external_author}}</i></li>
                    </ul>
                </td>
                <td>
                    <ul class="list-unstyled">

                        <li ng-repeat="person in article.photographers">

                            <i class="fa fa-paint-brush" ng-show="article.use_illustration"> </i>
                            <i class="fa fa-camera" ng-show="!article.use_illustration"> </i>
                            <span person-widget="person">{{ person.full_name }}</span>
                        </li>
                        <li><i tooltip="Ekstern">{{article.external_author}}</i></li>
                    </ul>
                </td>

                <!-- Show only a small part of a long message, with tooltip for the long text -->
                <td>
                    <textwrapper text="article.comment" length="20"></textwrapper>
                </td>

                <td>{{ article.content_length }}</td>
                <td style="white-space: nowrap">
                    <i class="fa fa-user fa-lg" tooltip="Om bildetekster er satt"
                       ng-class="{'text-danger': !article.image_text || article.image_text.length == 0, 'text-success': article.image_text.length > 0}"></i>

                    <i class="fa fa-quote-right fa-lg" tooltip="Om sitatsjekk er i orden"
                       ng-class="{'text-danger': !article.quote_check_status, 'text-success': article.quote_check_status}"></i>

                    <span style="background-color: {{article.status.color}}; padding: 3px;">{{ article.status.name }}</span>
                </td>
                <td>
                    {{ article.section.name }}
                </td>
                <td>
                    {{ article.publication.name }}
                </td>
            </tr>
            </tbody>

        </table>
    </div>

<div class="alert-info" ng-show="data.length == 201" style="padding: 5px">For mange resultat, viser bare de nyeste. Juster søket.</div>
</div>