<!--
  ~ Copyright 2016 Studentmediene i Trondheim AS
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <!--
  ~ Copyright 2014 Studentmediene i Trondheim AS
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->


    <!-- The initial changeset, containing the full database layout at release -->
    <changeSet id="1412787818529-1" author="Mats (generated)">
        <createTable tableName="article">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="comment" type="TEXT"/>
            <column name="content" type="TEXT"/>
            <column name="lastupdated" type="datetime"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="note" type="TEXT"/>
            <column name="photostatus" type="VARCHAR(255)"/>
            <column name="publication_id" type="BIGINT"/>
            <column name="section_id" type="BIGINT"/>
            <column name="status_id" type="BIGINT"/>
            <column name="type_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="article_journalist">
            <column name="article_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="journalists_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="article_photographer">
            <column name="article_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="photographers_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="articlerevision">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="content" type="TEXT"/>
            <column name="saveddate" type="datetime"/>
            <column name="article_id" type="BIGINT"/>
            <column name="status_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="articlestatus">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="color" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="articletype">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="disposition">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="publication_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="disposition_page">
            <column name="disposition_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="pages_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="note">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="content" type="TEXT"/>
            <column name="owner_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="page">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="advertisement" type="BOOLEAN" defaultValueBoolean="false"/>
            <column name="note" type="VARCHAR(255)"/>
            <column name="pagenr" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="section_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="page_article">
            <column name="page_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="articles_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="articles_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="person">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="BOOLEAN" defaultValueBoolean="false"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="firstname" type="VARCHAR(255)"/>
            <column name="fullname" type="VARCHAR(255)"/>
            <column name="phonenumber" type="VARCHAR(255)"/>
            <column name="username" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="publication">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="releasedate" type="date"/>
        </createTable>

        <createTable tableName="publication_page">
            <column name="publication_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="pages_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="pages_order" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="section">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="source">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="address" type="TEXT"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="note" type="TEXT"/>
            <column name="telephone" type="VARCHAR(255)"/>
            <column name="webpage" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="source_sourcetag">
            <column name="source_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="tags_tag" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="sourcetag">
            <column name="tag" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey columnNames="article_id, journalists_id"  tableName="article_journalist"/>

        <addPrimaryKey columnNames="article_id, photographers_id"  tableName="article_photographer"/>

        <addPrimaryKey columnNames="id" tableName="disposition"/>

        <addPrimaryKey columnNames="disposition_id, pages_id" tableName="disposition_page"/>

        <addPrimaryKey columnNames="page_id, articles_order" tableName="page_article"/>

        <addPrimaryKey columnNames="id" tableName="person"/>

        <addPrimaryKey columnNames="publication_id, pages_order" tableName="publication_page"/>

        <addPrimaryKey columnNames="source_id, tags_tag" tableName="source_sourcetag"/>

        <addPrimaryKey columnNames="tag" tableName="sourcetag"/>

        <addUniqueConstraint columnNames="pages_id" constraintName="pages_id_unique" deferrable="false" disabled="false" initiallyDeferred="false" tableName="disposition_page"/>

        <addForeignKeyConstraint baseColumnNames="owner_id" baseTableName="note" constraintName="FK_note_person" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="person"/>

        <addForeignKeyConstraint baseColumnNames="section_id" baseTableName="page" constraintName="FK_page_section" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="section"/>

        <addForeignKeyConstraint baseColumnNames="status_id" baseTableName="article" constraintName="FK_article_articlestatus" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="articlestatus"/>

        <addForeignKeyConstraint baseColumnNames="publication_id" baseTableName="article" constraintName="FK_article_publication" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="publication"/>

        <addForeignKeyConstraint baseColumnNames="type_id" baseTableName="article" constraintName="FK_article_articletype" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="articletype"/>

        <addForeignKeyConstraint baseColumnNames="section_id" baseTableName="article" constraintName="FK_article_section" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="section"/>

        <addForeignKeyConstraint baseColumnNames="photographers_id" baseTableName="article_photographer" constraintName="FK_article_photographer_person" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="person"/>

        <addForeignKeyConstraint baseColumnNames="article_id" baseTableName="article_photographer" constraintName="FK_article_photographer_article" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="article"/>

        <addForeignKeyConstraint baseColumnNames="page_id" baseTableName="page_article" constraintName="FK_page_article_page" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="page"/>

        <addForeignKeyConstraint baseColumnNames="articles_id" baseTableName="page_article" constraintName="FK_page_article_article" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="article"/>

        <addForeignKeyConstraint baseColumnNames="pages_id" baseTableName="publication_page" constraintName="FK_publication_page_page" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="page"/>

        <addForeignKeyConstraint baseColumnNames="publication_id" baseTableName="publication_page" constraintName="FK_publication_page_publication" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="publication"/>

        <addForeignKeyConstraint baseColumnNames="disposition_id" baseTableName="disposition_page" constraintName="FK_disposition_page_disposition" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="disposition"/>

        <addForeignKeyConstraint baseColumnNames="pages_id" baseTableName="disposition_page" constraintName="FK_disposition_page_page" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="page"/>

        <addForeignKeyConstraint baseColumnNames="publication_id" baseTableName="disposition" constraintName="FK_disposition_publication" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="publication"/>

        <addForeignKeyConstraint baseColumnNames="status_id" baseTableName="articlerevision" constraintName="FK_articlerevision_articlestatus" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="articlestatus"/>

        <addForeignKeyConstraint baseColumnNames="article_id" baseTableName="articlerevision" constraintName="FK_articlerevision_article" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="article"/>

        <addForeignKeyConstraint baseColumnNames="article_id" baseTableName="article_journalist" constraintName="FK_article_journalist_article" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="article"/>

        <addForeignKeyConstraint baseColumnNames="journalists_id" baseTableName="article_journalist" constraintName="FK_article_journalist_person" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="person"/>

        <addForeignKeyConstraint baseColumnNames="tags_tag" baseTableName="source_sourcetag" constraintName="FK_source_sourcetag_sourcetag" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="tag" referencedTableName="sourcetag"/>

        <addForeignKeyConstraint baseColumnNames="source_id" baseTableName="source_sourcetag" constraintName="FK_source_sourcetag_source" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="source"/>
    </changeSet>


    <!-- Adding some article metadata -->
    <changeSet id="2" author="Mats" context="live,dev">
        <!-- sections -->
        <insert tableName="section"><column name="id">1</column><column name="name">Musikk</column></insert>
        <insert tableName="section"><column name="id">2</column><column name="name">Debatt</column></insert>
        <insert tableName="section"><column name="id">3</column><column name="name">Nyhet</column></insert>
        <insert tableName="section"><column name="id">4</column><column name="name">Sport</column></insert>
        <insert tableName="section"><column name="id">5</column><column name="name">Forbruker</column></insert>
        <insert tableName="section"><column name="id">6</column><column name="name">Reportasje</column></insert>
        <insert tableName="section"><column name="id">7</column><column name="name">Spit</column></insert>
        <insert tableName="section"><column name="id">8</column><column name="name">Kultur</column></insert>
        <insert tableName="section"><column name="id">9</column><column name="name">Annet</column></insert>

        <!-- article types -->
        <insert tableName="articletype"><column name="id">1</column><column name="name">Anmeldelse</column></insert>
        <insert tableName="articletype"><column name="id">2</column><column name="name">Nyhetsartikkel</column></insert>
        <insert tableName="articletype"><column name="id">3</column><column name="name">Kulturartikkel</column></insert>
        <insert tableName="articletype"><column name="id">4</column><column name="name">Kulturtegn</column></insert>
        <insert tableName="articletype"><column name="id">5</column><column name="name">Reportasje</column></insert>
        <insert tableName="articletype"><column name="id">6</column><column name="name">Kommentar</column></insert>
        <insert tableName="articletype"><column name="id">7</column><column name="name">Debatt</column></insert>

        <!-- statuses -->
        <insert tableName="articlestatus"><column name="id">1</column><column name="color">#fff</column><column name="name">Ukjent</column></insert>
        <insert tableName="articlestatus"><column name="id">2</column><column name="color">#eee</column><column name="name">Planlagt</column></insert>
        <insert tableName="articlestatus"><column name="id">3</column><column name="color">#aaf</column><column name="name">Skrives</column></insert>
        <insert tableName="articlestatus"><column name="id">4</column><column name="color">#faa</column><column name="name">Deskes</column></insert>
        <insert tableName="articlestatus"><column name="id">5</column><column name="color">#afa</column><column name="name">Til godkjenning</column></insert>
        <insert tableName="articlestatus"><column name="id">6</column><column name="color">#0f0</column><column name="name">Publisert</column></insert>
    </changeSet>

    <!-- Add support for Google Drive -->
    <changeSet id="4" author="Mats">
        <addColumn tableName="article">
            <column name="googledriveid" type="VARCHAR(255)" />
        </addColumn>
    </changeSet>

    <!-- Adding KeyValue for storing of simple data that doesn't fit anywhere else -->
    <changeSet id="5" author="Mats">
        <createTable tableName="keyvalue">
            <column name="k" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="val" type="VARCHAR(255)" />
        </createTable>

        <addPrimaryKey columnNames="k" tableName="keyvalue"/>
    </changeSet>

    <!-- Add order fields for article status and types -->
    <changeSet id="6" author="Christoffer">
        <addColumn tableName="articlestatus">
            <column name="statusorder" type="BIGINT" />
        </addColumn>
        <addColumn tableName="articletype">
            <column name="typeorder" type="BIGINT" />
        </addColumn>

        <update tableName="articlestatus"><column name="statusorder">100</column><where>id=1</where></update>
        <update tableName="articlestatus"><column name="statusorder">200</column><where>id=2</where></update>
        <update tableName="articlestatus"><column name="statusorder">300</column><where>id=3</where></update>
        <update tableName="articlestatus"><column name="statusorder">400</column><where>id=4</where></update>
        <update tableName="articlestatus"><column name="statusorder">500</column><where>id=5</where></update>
        <update tableName="articlestatus"><column name="statusorder">600</column><where>id=6</where></update>

        <update tableName="articletype"><column name="typeorder">100</column><where>id=1</where></update>
        <update tableName="articletype"><column name="typeorder">200</column><where>id=2</where></update>
        <update tableName="articletype"><column name="typeorder">300</column><where>id=3</where></update>
        <update tableName="articletype"><column name="typeorder">400</column><where>id=4</where></update>
        <update tableName="articletype"><column name="typeorder">500</column><where>id=5</where></update>
        <update tableName="articletype"><column name="typeorder">600</column><where>id=6</where></update>
        <update tableName="articletype"><column name="typeorder">700</column><where>id=7</where></update>

    </changeSet>



    <!-- Add support for "raw content" for better free text search -->
    <changeSet id="4" author="EivindAndMats">
        <addColumn tableName="article">
            <column name="rawcontent" type="TEXT" />
        </addColumn>
    </changeSet>

    <!-- Adding new field to a revision, that states if that revision is
    saved to mark a status change, or because the text was updated -->
    <changeSet id="6" author="Mats">
        <addColumn tableName="articlerevision">
            <column name="statuschanged" type="BOOLEAN" />
        </addColumn>
    </changeSet>

    <!-- Storing the length of the article -->
    <changeSet id="7" author="Mats">
        <addColumn tableName="article">
            <column name="contentlength" type="BIGINT" defaultValueNumeric="0" />
        </addColumn>
    </changeSet>

    <!-- Save if the article should have illustration instead of photo -->
    <changeSet id="9" author="Mats">
        <addColumn tableName="article">
            <column name="useillustration" type="BOOLEAN" defaultValueBoolean="false" />
        </addColumn>
    </changeSet>

    <!-- Image texts -->
    <changeSet id="10" author="Mats">
        <addColumn tableName="article">
            <column name="imagetext" type="TEXT" />
        </addColumn>
    </changeSet>

    <!-- We can't delete statuses etc. because articles may be linked to them, so we add a field
        and hide it instead -->
    <changeSet id="12" author="Mats">
        <addColumn tableName="articlestatus">
            <column name="deleted" type="BOOLEAN" defaultValueBoolean="false" />
        </addColumn>
        <addColumn tableName="articletype">
            <column name="deleted" type="BOOLEAN" defaultValueBoolean="false" />
        </addColumn>
        <addColumn tableName="section">
            <column name="deleted" type="BOOLEAN" defaultValueBoolean="false" />
        </addColumn>
    </changeSet>

    <!-- Add and change some statuses etc. -->
    <changeSet id="13" author="Mats">
        <!-- new status -->
        <insert tableName="articlestatus">
            <column name="id">7</column>
            <column name="color">#009F00</column>
            <column name="name">Til korrektur</column>
            <column name="statusorder">700</column>
        </insert>

        <!-- "delete" by hiding it -->
        <update tableName="section">
            <column name="deleted" valueBoolean="true" />
            <where>id=5</where>
        </update>

        <insert tableName="articletype"><column name="id">8</column><column name="name">Forbruker</column><column name="typeorder">800</column></insert>
        <insert tableName="articletype"><column name="id">9</column><column name="name">Forskning</column><column name="typeorder">900</column></insert>
        <insert tableName="articletype"><column name="id">10</column><column name="name">Aktualitet</column><column name="typeorder">1000</column></insert>
        <insert tableName="articletype"><column name="id">11</column><column name="name">Smårep</column><column name="typeorder">1100</column></insert>
        <insert tableName="articletype"><column name="id">12</column><column name="name">Portrett</column><column name="typeorder">1200</column></insert>
        <insert tableName="articletype"><column name="id">13</column><column name="name">Sidespor</column><column name="typeorder">1300</column></insert>
        <insert tableName="articletype"><column name="id">14</column><column name="name">Småspalter</column><column name="typeorder">1400</column></insert>
    </changeSet>

    <!-- Add field for "sitatsjekk" -->
    <changeSet id="14" author="Christoffer">
        <addColumn tableName="article">
            <column name="quotecheckstatus" type="BOOLEAN" defaultValueBoolean="false"/>
        </addColumn>
    </changeSet>


    <!-- Add fields for external authors/photographers -->
    <changeSet id="15" author="Mats">
        <addColumn tableName="article">
            <column name="externalauthor" type="VARCHAR(255)" />
        </addColumn>
        <addColumn tableName="article">
            <column name="externalphotographer" type="VARCHAR(255)" />
        </addColumn>
    </changeSet>

    <changeSet id="16" author="Christoffer">
        <addColumn tableName="article">
            <column name="archived" type="BOOLEAN" defaultValueBoolean="false" />
        </addColumn>
    </changeSet>
    
    <changeSet id="17" author="Eivind">
        <createTable tableName="favouriteSection">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="section_id" type="BIGINT"/>
            <column name="owner_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    
    <changeSet id="18" author="Eivind">
        <dropTable tableName="favouriteSection"/>
    </changeSet>

    <changeSet id="19" author="Eivind">
        <createTable tableName="favouritesection">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="section_id" type="BIGINT"/>
            <column name="owner_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="20" author="Eivind">
        <dropTable tableName="disposition_page"/>
        <dropTable tableName="page_article"/>
        <dropTable tableName="publication_page"/>
    </changeSet>

    <changeSet id="21" author="Eivind">
        <dropTable tableName="disposition"/>
        <dropTable tableName="page"/>
    </changeSet>

    <changeSet id="22" author="Eivind">
        <createTable tableName="page">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="pagenr" type="BIGINT"/>
            <column name="note" type="VARCHAR(255)"/>
            <column name="advertisement" type="BOOLEAN"/>
            <column name="publication_id" type="BIGINT"/>
            <column name="layoutstatus_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="page_article">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="articles_id" type="BIGINT"/>
            <column name="page_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="publication_page">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="publication_id" type="BIGINT"/>
            <column name="pages_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="layoutstatus">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="color" type="VARCHAR(255)"/>
        </createTable>

        <insert tableName="layoutstatus">
            <column name="name">Ferdig</column>
            <column name="color">#9f9</column>
        </insert>
        <insert tableName="layoutstatus">
            <column name="name">Brekkes</column>
            <column name="color">#99f</column>
        </insert>
        <insert tableName="layoutstatus">
            <column name="name">Krise</column>
            <column name="color">#f99</column>
        </insert>
        <insert tableName="layoutstatus">
            <column name="name">Planlagt</column>
            <column name="color">#eee</column>
        </insert>
        <insert tableName="layoutstatus">
            <column name="name">Ukjent</column>
            <column name="color">#fff</column>
        </insert>
    </changeSet>

    <changeSet id="23" author="Christoffer">
        <!-- Article review options -->
        <createTable tableName="articlereview">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="name" type="VARCHAR(255)" />
            <column name="color" type="VARCHAR(255)" />
        </createTable>

        <addColumn tableName="article">
            <column name="review_id" type="BIGINT" defaultValueNumeric="1"/>
        </addColumn>

        <addColumn tableName="page">
            <column name="web" type="BOOLEAN" />
        </addColumn>

        <!-- Inserting the review-statuses   -->
        <insert tableName="articlereview">
            <column name="id">1</column>
            <column name="name">Ukjent</column>
            <column name="color">#FFF</column>
        </insert>

        <insert tableName="articlereview">
            <column name="id">2</column>
            <column name="name">Leses ikke</column>
            <column name="color">#FAA</column>
        </insert>

        <insert tableName="articlereview">
            <column name="id">3</column>
            <column name="name">Skrevet ut</column>
            <column name="color">#AAF</column>
        </insert>

        <insert tableName="articlereview">
            <column name="id">4</column>
            <column name="name">Lest</column>
            <column name="color">#AFA</column>
        </insert>
    </changeSet>
    <changeSet id="24" author="Christoffer">
        <update tableName="articlestatus"><column name="color">#ffffff</column><where>id=1</where></update>
        <update tableName="articlestatus"><column name="color">#eeeeee</column><where>id=2</where></update>
        <update tableName="articlestatus"><column name="color">#aaaaff</column><where>id=3</where></update>
        <update tableName="articlestatus"><column name="color">#ffaaaa</column><where>id=4</where></update>
        <update tableName="articlestatus"><column name="color">#aaffaa</column><where>id=5</where></update>
        <update tableName="articlestatus"><column name="color">#00ff00</column><where>id=6</where></update>

        <update tableName="articlereview"><column name="color">#ffffff</column><where>id=1</where></update>
        <update tableName="articlereview"><column name="color">#ffaaaa</column><where>id=2</where></update>
        <update tableName="articlereview"><column name="color">#aaaaff</column><where>id=3</where></update>
        <update tableName="articlereview"><column name="color">#aaffaa</column><where>id=4</where></update>

        <update tableName="layoutstatus"><column name="color">#99ff99</column><where>id=0</where></update>
        <update tableName="layoutstatus"><column name="color">#9999ff</column><where>id=1</where></update>
        <update tableName="layoutstatus"><column name="color">#ff9999</column><where>id=2</where></update>
        <update tableName="layoutstatus"><column name="color">#eeeeee</column><where>id=3</where></update>
        <update tableName="layoutstatus"><column name="color">#ffffff</column><where>id=4</where></update>
    </changeSet>

    <changeSet id="25" author="Eivind">
        <createTable tableName="landingpage">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="page" type="VARCHAR(255)"/>
            <column name="owner_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="26" author="Christoffer">
        <addColumn tableName="section">
            <column name="color" type="VARCHAR(255)" />
        </addColumn>

        <update tableName="section"><column name="color">#FFB3FF</column><where>id=1</where></update>
        <update tableName="section"><column name="color">#1AB2FF</column><where>id=2</where></update>
        <update tableName="section"><column name="color">#ABE3FF</column><where>id=3</where></update>
        <update tableName="section"><column name="color">#FFE96B</column><where>id=4</where></update>
        <update tableName="section"><column name="color">#98D98B</column><where>id=5</where></update>
        <update tableName="section"><column name="color">#B990D4</column><where>id=6</where></update>
        <update tableName="section"><column name="color">#FF4D4D</column><where>id=7</where></update>
        <update tableName="section"><column name="color">#FF7345</column><where>id=8</where></update>
        <update tableName="section"><column name="color">#CCCCCC</column><where>id=9</where></update>
    </changeSet>

    <changeSet id="27" author="Eivind">
        <addColumn tableName="page">
            <column name="done" type="BOOLEAN"/>
        </addColumn>
    </changeSet>

    <changeSet id="28" author="Christoffer">
        <update tableName="section">
            <column name="name">Forskning og forbruker</column>
            <column name="deleted" valueBoolean="false" />
            <where>id=5</where>
        </update>
    </changeSet>

    <changeSet id="29" author="Eivind">
        <dropColumn tableName="page" columnName="done"/>
    </changeSet>

    <changeSet id="30" author="Eivind">
        <addColumn tableName="page">
            <column name="done" type="BOOLEAN" valueBoolean="false" defaultValueBoolean="false"/>
        </addColumn>
    </changeSet>

    <changeSet id="31" author="Eivind">
        <createTable tableName="usernamemap">
            <column name="username" type="VARCHAR(255)">
                <constraints primaryKey="true"/>
            </column>
            <column name="id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!--Set all existing users to inactive so old ldap users are set as such (migrated users are updated anyways)-->
    <changeSet id="33" author="Eivind">
        <update tableName="person">
            <column name="active">false</column>
        </update>
    </changeSet>
    
    <changeSet id="36_addPersonGuid" author="Eivind">
        <addColumn tableName="person">
            <column name="guid" type="BINARY(16)" />
        </addColumn>
    </changeSet>

    <changeSet id="37_removePersonFirstname" author="Eivind">
        <dropColumn tableName="person" columnName="firstname" />
        <renameColumn tableName="person" oldColumnName="fullname" newColumnName="name" />
    </changeSet>

    <!-- I don't remember what this table was for in the first place -->
    <changeSet id="38_dropmaptable" author="Eivind">
        <dropTable tableName="usernamemap" />
    </changeSet>

    <changeSet id="39_removelanding" author="Eivind">
        <dropTable tableName="landingpage" />
    </changeSet>

    <!-- Since we now update person rows instead of replacing them, favourite section can be column in person -->
    <changeSet id="40_move_favsection_to_persontable" author="Eivind">
        <dropTable tableName="favouritesection" />
        <addColumn tableName="person">
            <column name="favouritesection_id" type="BIGINT" />
        </addColumn>
        <addForeignKeyConstraint
                baseTableName="person"
                baseColumnNames="favouritesection_id"
                constraintName="FK_person_favouritesection"
                referencedTableName="section"
                referencedColumnNames="id"
                onDelete="SET NULL"
                onUpdate="CASCADE"
        />
    </changeSet>

    <changeSet id="41_adduserphoto" author="Eivind">
        <addColumn tableName="person">
            <column name="photo" type="BLOB" />
        </addColumn>
    </changeSet>

    <changeSet id="42_adduserroles" author="Eirik">
        <createTable tableName="person_roles">
            <column name="person_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="roles" type="VARCHAR(255)" />
        </createTable>
        <addForeignKeyConstraint
                baseTableName="person_roles" baseColumnNames="person_id"
                constraintName="FK_role_person"
                referencedTableName="person"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"
        />
    </changeSet>
    <changeSet id="42_addnews" author="Christoffer">
        <createTable tableName="news">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="title" type="VARCHAR(255)" />
            <column name="date" type="DATE" />
            <column name="content" type="TEXT" />
            <column name="author_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addForeignKeyConstraint
            baseTableName="news" baseColumnNames="author_id"
            constraintName="FK_news_person"
            referencedTableName="person"
            referencedColumnNames="id"
        />
    </changeSet>
</databaseChangeLog>
